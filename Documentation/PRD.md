1. Vision & ObjectivesProject ComLock aims to establish the "Anonymously Resilient" standard for digital communication. Unlike legacy secure messengers (Signal, WhatsApp) which protect content but leak metadata, and unlike anonymity networks (Tor) which sacrifice latency and usability, ComLock fuses these into a single high-assurance stack.Core Value Proposition:Unlinkability: A Global Network Adversary (GNA) cannot correlate a sender to a receiver.Post-Quantum Confidentiality: All communications are immune to "Harvest Now, Decrypt Later" via hybrid ML-KEM encapsulation.Identity Independence: No phone numbers, emails, or central servers.2. Functional Requirements2.1 The Cryptographic Core: PQ-Triple RatchetThe messaging layer must implement the Triple Ratchet protocol, an evolution of the Double Ratchet that adds a continuous KEM-based re-keying mechanism.Hybrid Handshake: Initial X3DH must be replaced with PQXDH, utilizing X25519 for classical security and ML-KEM-1024 (Kyber) for quantum resistance.The KEM Braid: To mitigate the high bandwidth cost of Kyber keys (~1.5KB), the client must implement a "Sparse Continuous Key Agreement" (SCKA).Mechanism: The KEM ratchet does not advance with every message. Instead, it advances opportunistically (e.g., every 50 messages or 24 hours).Entropy Injection: The output of the KEM encapsulation is mixed into the KDF chain ($CK_{n+1}$) alongside the ECDH output, ensuring that a compromise of the current state is healed against quantum adversaries in the future (Post-Compromise Security).2.2 Transport: Stratified Mixnet (Loopix)Clients do not connect directly. They connect to a Gateway which routes traffic through a Stratified Mixnet.Packet Format: All packets must be indistinguishable 32KB Sphinx packets.Poisson Mixing: Clients must inject dummy traffic (loops) according to a Poisson process ($\lambda_{loop}$). Real messages are delayed by a random variable $t$ drawn from an exponential distribution to decorrelate ingress/egress timing.2.3 Identity: Zero-Knowledge MembershipOnboarding: A user generates a local keypair and presents a "Proof of Humanity" (e.g., a blind signature from a localized trust anchor or a crypto-asset stake) to enter a Rate Limiting Nullifier (RLN) Merkle Tree.Signaling: Every message includes a ZK-Proof proving membership in the tree without revealing the leaf index.Slashing: If a user sends $>1$ message per epoch (e.g., 10s), their secret key is mathematically revealed by the protocol (Shamir's Secret Sharing reconstruction), allowing the network to blacklist them.3. Non-Functional Requirements & ConstraintsLatency: End-to-end latency for text messages must be $\le 2.5$ seconds (95th percentile).Bandwidth: Idle background traffic (Cover Traffic) must not exceed 5KB/s to preserve battery on mobile.Battery: Mobile clients must utilize the device's NPU/DSP for ML-KEM operations where possible to minimize main CPU wake-time.Panic Layer (Duress):Constraint: The app must support a "Duress Password."Behavior: Entering this password at the unlock screen must instantly delete the master keys from the Secure Enclave and populate the database with cryptographically signed "dummy" chat history (pre-generated) to satisfy coercive inspection.4. User StoriesAs a Whistleblower: I need to transfer a 50MB PDF to a journalist. The transfer must be chunked into Sphinx packets and mixed over 10 minutes so that my ISP sees only a constant, low-bandwidth stream indistinguishable from background noise.As a Diplomat: I need to pair with a contact without a server knowing our relationship. We perform a QR-code based Short Authentication String (SAS) verification that exchanges ML-KEM public keys directly over Bluetooth/Camera, bypassing the internet entirely for the initial trust establishment.